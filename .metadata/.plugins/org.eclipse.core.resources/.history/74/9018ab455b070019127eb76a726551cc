package com.chenming.algorithm;

import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;

import javax.crypto.KeyGenerator;
import javax.crypto.Mac;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;
import javax.xml.bind.annotation.adapters.HexBinaryAdapter;

import org.junit.Test;

/**
 * 测试MAC加密算法
 * 	MAC加密算法是单向的,是基于散列函数
 * 	1. 对于相同的秘钥,相同的数据,加密后得到的摘要是相同的
 * 	2. 对于不同的秘钥或者不同的数据,加密后得到的摘要是不同的
 * @author 陈明
 * @date 2018年12月24日
 */
public class MACTest {

	/**
	 * HmacMD5摘要算法(手动指定秘钥)
	 * 对于相同的秘钥,相同的数据,加密后得到的摘要是相同的
	 * @throws NoSuchAlgorithmException 
	 * @throws InvalidKeyException 
	 */
	@Test
	public void testHmacMD5() throws NoSuchAlgorithmException, InvalidKeyException {
		
		//要加密的消息
		String str = "这是要加密的消息";
		//秘钥
		byte[] key = "cm".getBytes();
		
		SecretKeySpec secretKeySpec = new SecretKeySpec(key, "HmacMD5");
		
		//实例化Mac
		Mac mac = Mac.getInstance(secretKeySpec.getAlgorithm());
		
		//初始化Mac
		mac.init(secretKeySpec);
		
		//执行消息摘要
		byte[] digest = mac.doFinal(str.getBytes());
		
		System.out.println(new HexBinaryAdapter().marshal(digest));		//04CCEA27E8F571E3AF478E8F8B3CCA71
	}
	
	
	/**
	 * HmacMD5摘要算法(自动生成秘钥)
	 * 自动生成的秘钥每次都是不相同的,因此每次加密后得到的摘要都是不同的
	 * @throws NoSuchAlgorithmException 
	 * @throws InvalidKeyException 
	 */
	@Test
	public void testHmacMD5_2() throws NoSuchAlgorithmException, InvalidKeyException {
		
		//自动生成秘钥
		KeyGenerator keygen = KeyGenerator.getInstance("HmacMD5");
		SecretKey generateKey = keygen.generateKey();
		byte[] key = generateKey.getEncoded();
		System.out.println(Arrays.toString(key));
		
		//要加密的消息
		String str = "这是要加密的消息";
		
		SecretKeySpec secretKeySpec = new SecretKeySpec(key, "HmacMD5");
		
		//实例化Mac
		Mac mac = Mac.getInstance(secretKeySpec.getAlgorithm());
		
		//初始化Mac
		mac.init(secretKeySpec);
		
		//执行消息摘要
		byte[] digest = mac.doFinal(str.getBytes());
		
		System.out.println(new HexBinaryAdapter().marshal(digest));		//04CCEA27E8F571E3AF478E8F8B3CCA71
	}
	
	
	@Test
	public void testHmacSHA() throws NoSuchAlgorithmException {
	
		//指定key
		byte[] key = "cm".getBytes();
		
		SecretKeySpec secretKeySpec = new SecretKeySpec(key, "HmacSHA");
		
		//实例化Mac
		Mac mac = Mac.getInstance(secretKeySpec.getAlgorithm());
		
		//初始化Mac
		mac.init(secretKeySpec);
	}
	
	
	
	
	@Test
	public void test() {
		System.out.println("04CCEA27E8F571E3AF478E8F8B3CCA71".length());
	}
	
	
	
	
}
